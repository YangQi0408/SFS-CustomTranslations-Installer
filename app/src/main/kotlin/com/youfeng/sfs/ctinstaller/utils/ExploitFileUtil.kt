package com.youfeng.sfs.ctinstaller.utils

import com.anggrayudi.storage.SimpleStorage
import com.youfeng.sfs.ctinstaller.core.Constants
import okio.FileSystem
import okio.Path.Companion.toPath

object ExploitFileUtil {
    private val fileSystem = FileSystem.SYSTEM
    private val androidDataPath =
        "${SimpleStorage.externalStoragePath}/${Constants.ANDROID_DATA_DIRECTORY}"

    const val ZWSP = "\u200B"

    val isExploitable: Boolean
        get() {
            return try {
                fileSystem.list(androidDataPath.toPathWithZwsp())
                true
            } catch (_: Exception) {
                false
            }
        }
}

fun String.toPathWithZwsp() =
    replace(
        Constants.ANDROID_DATA_DIRECTORY,
        "${Constants.ANDROID_DATA_DIRECTORY}${ExploitFileUtil.ZWSP}"
    ).toPath()
